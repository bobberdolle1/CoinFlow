# ะะฝัะตะณัะฐัะธั ะฐะบัะธะน ะฒ CoinFlow Bot

## ะะฑะทะพั

CoinFlow Bot v3.1+ ัะตะฟะตัั ะฟะพะปะฝะพัััั ะฟะพะดะดะตัะถะธะฒะฐะตั ัะฐะฑะพัั ั ะฐะบัะธัะผะธ (stocks) ะฝะฐัะฐะฒะฝะต ั ะบัะธะฟัะพะฒะฐะปััะฐะผะธ ะธ ัะธะฐัะฝัะผะธ ะฒะฐะปััะฐะผะธ. ะะบัะธะธ ะธะฝัะตะณัะธัะพะฒะฐะฝั ะฒะพ ะฒัะต ะบะปััะตะฒัะต ััะฝะบัะธะธ ะฑะพัะฐ.

---

## ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะฐะบัะธะธ

### ะะปะพะฑะฐะปัะฝัะต ะฐะบัะธะธ (US Market)

| ะขะธะบะตั | ะะพะผะฟะฐะฝะธั | ะะธัะถะฐ |
|-------|----------|-------|
| AAPL | Apple Inc. | NASDAQ |
| MSFT | Microsoft | NASDAQ |
| GOOGL | Alphabet (Google) | NASDAQ |
| AMZN | Amazon | NASDAQ |
| NVDA | NVIDIA | NASDAQ |
| TSLA | Tesla | NASDAQ |
| META | Meta (Facebook) | NASDAQ |
| V | Visa | NYSE |
| JPM | JPMorgan Chase | NYSE |
| ... | +15 ะดััะณะธั | - |

### ะะพััะธะนัะบะธะต ะฐะบัะธะธ (MOEX)

| ะขะธะบะตั | ะะพะผะฟะฐะฝะธั | ะะธัะถะฐ |
|-------|----------|-------|
| SBER.ME | ะกะฑะตัะฑะฐะฝะบ | MOEX |
| GAZP.ME | ะะฐะทะฟัะพะผ | MOEX |
| LKOH.ME | ะัะบะพะนะป | MOEX |
| GMKN.ME | ะะพัะฝะธะบะตะปั | MOEX |
| YNDX.ME | ะฏะฝะดะตะบั | MOEX |
| ROSN.ME | ะะพัะฝะตััั | MOEX |
| NVTK.ME | ะะพะฒะฐััะบ | MOEX |
| ... | +10 ะดััะณะธั | - |

---

## ะคัะฝะบัะธะพะฝะฐะป

### 1. ะัะพัะผะพัั ะธะฝัะพัะผะฐัะธะธ ะพะฑ ะฐะบัะธัั

```
๐ Stocks โ Global Stocks โ AAPL
```

ะัะพะฑัะฐะถะฐะตััั:
- ะขะตะบััะฐั ัะตะฝะฐ
- ะะทะผะตะฝะตะฝะธะต ะทะฐ 24 ัะฐัะฐ (%)
- ะัะฝะพัะฝะฐั ะบะฐะฟะธัะฐะปะธะทะฐัะธั
- ะะฑััะผ ัะพัะณะพะฒ
- ะะฝะพะฟะบะฐ ะดะปั ะฟัะพัะผะพััะฐ ะณัะฐัะธะบะฐ

### 2. ะัะฐัะธะบะธ ะฐะบัะธะน

```
๐ Stocks โ Global Stocks โ AAPL โ Show Chart
```

ะะพัััะฟะฝัะต ะฟะตัะธะพะดั:
- 7 ะดะฝะตะน
- 30 ะดะฝะตะน (ะฟะพ ัะผะพะปัะฐะฝะธั)
- 90 ะดะฝะตะน
- 365 ะดะฝะตะน

ะะฐะฝะฝัะต ะธะท **Yahoo Finance** (ะดะปั ะณะปะพะฑะฐะปัะฝัั) ะธ **MOEX API** (ะดะปั ัะพััะธะนัะบะธั).

### 3. ะัะพะณะฝะพะทั ัะตะฝ ะฐะบัะธะน

ะขะตะฟะตัั ะฟัะพะณะฝะพะทั ัะฐะฑะพัะฐัั ะฝะต ัะพะปัะบะพ ะดะปั ะบัะธะฟัั, ะฝะพ ะธ ะดะปั ะฐะบัะธะน:

```python
# ะัะธะผะตั ะฟัะพะณะฝะพะทะฐ ะดะปั ะฐะบัะธะน
chart, stats, ai_analysis = await prediction_generator.generate_prediction_with_vision_analysis(
    symbol='AAPL',
    asset_type='stock',
    model_type='arima',
    days=90,
    forecast_days=7
)
```

ะะพัััะฟะฝัะต ะผะพะดะตะปะธ:
- **ARIMA** - ะดะปั ะฐะบัะธะน ั ะฒััะฐะถะตะฝะฝัะผ ััะตะฝะดะพะผ
- **Linear Regression** - ะดะปั ััะฐะฑะธะปัะฝัั ะฐะบัะธะน
- **Prophet** (ะพะฟัะธะพะฝะฐะปัะฝะพ) - ะดะปั ัะปะพะถะฝัั ะฟะฐััะตัะฝะพะฒ

### 4. ะะ-ะฐััะธััะตะฝั ั ะฟะพะดะดะตัะถะบะพะน ะฐะบัะธะน

ะะพั ะฟะพะฝะธะผะฐะตั ะตััะตััะฒะตะฝะฝัะต ะทะฐะฟัะพัั:

**ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ:**
- "ะะพะบะฐะถะธ ะณัะฐัะธะบ Apple" โ ะัะพะฑัะฐะถะฐะตั ะณัะฐัะธะบ AAPL
- "ะัะพะณะฝะพะท ะดะปั Tesla" โ ะะตะฝะตัะธััะตั ะฟัะพะณะฝะพะท TSLA
- "ะกะบะพะปัะบะพ ััะพะธั ะกะฑะตัะฑะฐะฝะบ?" โ ะะพะบะฐะทัะฒะฐะตั ัะตะบัััั ัะตะฝั SBER.ME
- "ะกัะฐะฒะฝะธ Microsoft ะธ Google" โ (ะฟะปะฐะฝะธััะตััั)

**ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะฐะปััะตัะฝะฐัะธะฒะฝัะต ะฝะฐะทะฒะฐะฝะธั:**
- Apple โ AAPL
- Tesla โ TSLA
- Microsoft โ MSFT
- ะกะฑะตั, ะกะฑะตัะฑะฐะฝะบ โ SBER.ME
- ะะฐะทะฟัะพะผ โ GAZP.ME

### 5. ะะพัััะพะปะธะพ ั ะฐะบัะธัะผะธ

ะะพะฑะฐะฒััะต ะฐะบัะธะธ ะฒ ัะฒะพะน ะฟะพัััะตะปั:

```
๐ผ Portfolio โ Add Asset โ Stock โ AAPL โ Quantity: 10
```

ะคัะฝะบัะธะธ:
- ะััะปะตะถะธะฒะฐะฝะธะต ััะพะธะผะพััะธ ะฟะพัััะตะปั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฐัััั P&L (ะฟัะธะฑัะปั/ัะฑััะพะบ)
- ะะธะฒะตััะธัะธะบะฐัะธั ะฟะพ ัะธะฟะฐะผ ะฐะบัะธะฒะพะฒ (crypto/stock/fiat)
- ะญะบัะฟะพัั ะฒ CSV, JSON, Google Sheets

### 6. ะฃะฒะตะดะพะผะปะตะฝะธั ะฟะพ ัะตะฝะฐะผ

```
๐ Notifications โ Add Alert โ Stock โ TSLA โ Above $300
```

ะขะธะฟั ะฐะปะตััะพะฒ:
- ะฆะตะฝะฐ ะฒััะต ะฟะพัะพะณะฐ
- ะฆะตะฝะฐ ะฝะธะถะต ะฟะพัะพะณะฐ
- ะะทะผะตะฝะตะฝะธะต ะฝะฐ X%

---

## API ะธ ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั

### Yahoo Finance (yfinance)

ะัะฟะพะปัะทัะตััั ะดะปั:
- ะะปะพะฑะฐะปัะฝัะต ะฐะบัะธะธ (NASDAQ, NYSE, etc.)
- ะััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต
- ะัะพะณะฝะพะทะธัะพะฒะฐะฝะธะต

```python
import yfinance as yf

stock = yf.Ticker('AAPL')
data = stock.history(period='1mo')
```

### MOEX API

ะัะฟะพะปัะทัะตััั ะดะปั:
- ะะพััะธะนัะบะธะต ะฐะบัะธะธ
- ะะตะฐะปัะฝะพะต ะฒัะตะผั (ะฑะตะท ะทะฐะดะตัะถะบะธ)

```python
url = f'https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/{ticker}.json'
```

### ะััะธัะพะฒะฐะฝะธะต

ะะฐะฝะฝัะต ะบััะธัััััั ะฝะฐ **5 ะผะธะฝัั** ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ:
- ะกะฝะธะถะตะฝะธะต ะฝะฐะณััะทะบะธ ะฝะฐ API
- ะัััััะน ะพัะบะปะธะบ
- ะะบััะฐะปัะฝะพััั ะดะฐะฝะฝัั

---

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            StockService                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                              โ
โ  get_global_stock(ticker) โโโบ Yahoo Finance โ
โ  get_russian_stock(ticker) โโโบ MOEX API     โ
โ  get_cbr_rate(currency) โโโโโบ CBR API       โ
โ                                              โ
โโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ
        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         StocksHandler                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  show_stocks_menu()                          โ
โ  show_global_stocks()                        โ
โ  show_russian_stocks()                       โ
โ  show_stock_chart()                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะฃะดะฐะปะตะฝะธะต ะพัะดะตะปัะฝะพะณะพ ัะฐะทะดะตะปะฐ ะฆะ ะะค

### ะงัะพ ะธะทะผะตะฝะธะปะพัั?

**ะะฐะฝััะต:**
```
๐ Stocks
  โโ Global Stocks
  โโ Russian Stocks
  โโ ๐ฑ CBR Rates (ะพัะดะตะปัะฝัะน ัะฐะทะดะตะป)
```

**ะขะตะฟะตัั:**
```
๐ Stocks
  โโ Global Stocks
  โโ Russian Stocks

๐ฑ Converter (ะฒัััะพะตะฝะพ)
  โโ Market rate (default)
  โโ CBR rate (ะพะฟัะธั ะดะปั RUB)
```

### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั?

ะัััั ะฆะ ะะค ัะตะฟะตัั ะธัะฟะพะปัะทััััั ะบะฐะบ **ะฐะปััะตัะฝะฐัะธะฒะฝัะน ะธััะพัะฝะธะบ ะดะฐะฝะฝัั** ะดะปั ะบะพะฝะฒะตััะฐัะธะธ ั ััะฐััะธะตะผ ััะฑะปั:

```python
# ะัะธ ะบะพะฝะฒะตััะฐัะธะธ USD โ RUB
rate = converter.get_rate('USD', 'RUB', source='cbr')  # ะัะธัะธะฐะปัะฝัะน ะบััั ะฆะ
rate = converter.get_rate('USD', 'RUB', source='market')  # ะัะฝะพัะฝัะน ะบััั (default)
```

**ะัะตะธะผััะตััะฒะฐ:**
- ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน ะธะฝัะตััะตะนั
- ะะตะฝััะต ะฝะฐะฒะธะณะฐัะธะธ ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั
- ะะบัะธะธ ััะฐะปะธ ะฟะตัะฒะพะบะปะฐััะฝัะผะธ ะฐะบัะธะฒะฐะผะธ
- ะฆะ ะะค ะพััะฐัััั ะดะพัััะฟะฝัะผ ัะฐะผ, ะณะดะต ะฝัะถะตะฝ

---

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะะพะฝะธัะพัะธะฝะณ ะฟะพัััะตะปั ะฐะบัะธะน

```python
# ะะพะปัะทะพะฒะฐัะตะปั ะดะพะฑะฐะฒะปัะตั ะฐะบัะธะธ ะฒ ะฟะพัััะตะปั
portfolio.add_item(user_id, 'AAPL', quantity=10, asset_type='stock')
portfolio.add_item(user_id, 'TSLA', quantity=5, asset_type='stock')
portfolio.add_item(user_id, 'SBER.ME', quantity=100, asset_type='stock')

# ะะพะปััะตะฝะธะต ัะฒะพะดะบะธ
summary = portfolio.get_summary(user_id)
# {
#   'total_value_usd': 12450.50,
#   'by_type': {
#     'stock': {'total_value_usd': 12450.50, 'count': 3}
#   }
# }
```

### ะัะธะผะตั 2: ะัะพะณะฝะพะท ั AI-ะฐะฝะฐะปะธะทะพะผ

```python
# ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะฟัะฐัะธะฒะฐะตั ะฟัะพะณะฝะพะท ะดะปั Tesla
chart, stats, analysis = await bot.prediction_generator.generate_prediction_with_vision_analysis(
    symbol='TSLA',
    asset_type='stock',
    model_type='arima',
    days=90,
    forecast_days=7
)

# ะัะฟัะฐะฒะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
message = f"""
๐ ะัะพะณะฝะพะท TSLA ะฝะฐ 7 ะดะฝะตะน

๐ฐ ะขะตะบััะฐั ัะตะฝะฐ: ${stats['current']:.2f}
๐ฎ ะัะพะณะฝะพะท: ${stats['predicted']:.2f}
๐ ะะทะผะตะฝะตะฝะธะต: {stats['change']:+.2f}%
๐ฏ ะะพะดะตะปั: {stats['model']}

๐ค AI-ะฐะฝะฐะปะธะท:
{analysis}
"""

await update.message.reply_photo(photo=chart, caption=message)
```

### ะัะธะผะตั 3: ะะพะปะพัะพะฒะพะน ะทะฐะฟัะพั

```
๐ค "ะะพะบะฐะถะธ ะผะฝะต ะณัะฐัะธะบ Apple ะทะฐ ะฟะพัะปะตะดะฝะธะต ััะธ ะผะตัััะฐ"

โ (Voice โ Text via Whisper)

โ (Text โ AI interpretation)

โ {
    "command": "CHART",
    "symbol": "AAPL",
    "days": 90,
    "type": "stock"
  }

โ (Execute command)

๐ [ะัะฐัะธะบ AAPL 90 ะดะฝะตะน]
```

---

## ะะณัะฐะฝะธัะตะฝะธั

### 1. ะัะฝะพัะฝัะต ัะฐัั

ะะบัะธะธ ัะพัะณััััั ัะพะปัะบะพ ะฒ ะพะฟัะตะดะตะปัะฝะฝัะต ัะฐัั:
- **US Market**: 16:30 - 23:00 ะะกะ (ะฟะฝ-ะฟั)
- **MOEX**: 10:00 - 18:40 ะะกะ (ะฟะฝ-ะฟั)

ะะฝะต ัะพัะณะพะฒัั ัะฐัะพะฒ ะดะฐะฝะฝัะต ะฝะต ะพะฑะฝะพะฒะปััััั.

### 2. API Limits

- **Yahoo Finance**: ะฑะตะท ะถะตััะบะธั ะปะธะผะธัะพะฒ, ะฝะพ ะตััั rate limiting
- **MOEX API**: 100 ะทะฐะฟัะพัะพะฒ/ะผะธะฝััั

ะััะธัะพะฒะฐะฝะธะต ะฟะพะผะพะณะฐะตั ะธะทะฑะตะถะฐัั ะฟัะตะฒััะตะฝะธั ะปะธะผะธัะพะฒ.

### 3. ะะฐะดะตัะถะบะฐ ะดะฐะฝะฝัั

- Yahoo Finance: ะทะฐะดะตัะถะบะฐ ~15 ะผะธะฝัั ะดะปั free tier
- MOEX API: real-time ะดะปั ัะพััะธะนัะบะธั ะฐะบัะธะน

---

## FAQ

**Q: ะะพะถะฝะพ ะปะธ ะดะพะฑะฐะฒะธัั ะดััะณะธะต ะฐะบัะธะธ?**  
A: ะะฐ, ะดะพะฑะฐะฒััะต ัะธะบะตัั ะฒ `stock_service.py` โ `GLOBAL_STOCKS` ะธะปะธ `RUSSIAN_STOCKS`.

**Q: ะะพัะตะผั ะฝะตั ะฟัะพะณะฝะพะทะพะฒ ะดะปั ะผะตะปะบะธั ะฐะบัะธะน?**  
A: ะะตะดะพััะฐัะพัะฝะพ ะธััะพัะธัะตัะบะธั ะดะฐะฝะฝัั. ะขัะตะฑัะตััั ะผะธะฝะธะผัะผ 30 ะดะฝะตะน ัะพัะณะพะฒะปะธ.

**Q: ะะฐะบ ัะฐะฑะพัะฐะตั ะฒะธะทัะฐะปัะฝัะน ะฐะฝะฐะปะธะท ะดะปั ะฐะบัะธะน?**  
A: ะัะฐัะธะบ ะพัะฟัะฐะฒะปัะตััั ะฒ qwen3-vl ะผะพะดะตะปั, ะบะพัะพัะฐั ะฐะฝะฐะปะธะทะธััะตั ะฟะฐััะตัะฝั ะธ ััะตะฝะดั.

**Q: ะะพะถะฝะพ ะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ัะตะฐะปัะฝัะต ัะพัะณะพะฒัะต ัะธะณะฝะฐะปั?**  
A: ะะฐ, ะฝะพ ััะพ ะฝะต ัะธะฝะฐะฝัะพะฒัะต ัะพะฒะตัั. ะัะฟะพะปัะทัะนัะต ะฝะฐ ัะฒะพะน ัะธัะบ.

**Q: ะะพะดะดะตัะถะธะฒะฐัััั ะปะธ ETF ะธ ะธะฝะดะตะบัั?**  
A: ะงะฐััะธัะฝะพ. ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ัะธะบะตัั ETF (SPY, QQQ, etc.) ะฒ ัะฟะธัะพะบ ะฐะบัะธะน.

---

## Roadmap

### v3.2 (Q4 2025)
- [ ] ะกัะฐะฒะฝะตะฝะธะต ะฐะบัะธะน side-by-side
- [ ] ะะฝะดะธะบะฐัะพัั (RSI, MACD, Bollinger Bands)
- [ ] ะกะบัะธะฝะตั ะฐะบัะธะน ะฟะพ ะบัะธัะตัะธัะผ

### v3.3 (Q1 2026)
- [ ] ETF ะธ ะธะฝะดะตะบัั
- [ ] Dividends tracking
- [ ] Corporate events (splits, earnings)

### v4.0 (Q2 2026)
- [ ] ะะตะฐะปัะฝัะต ัะพัะณะพะฒัะต ะธะฝัะตะณัะฐัะธะธ (API ะฑัะพะบะตัะพะฒ)
- [ ] Paper trading (ะดะตะผะพ-ัะพัะณะพะฒะปั)
- [ ] Backtest ัััะฐัะตะณะธะน

---

**ะะตััะธั ะดะพะบัะผะตะฝัะฐ**: 1.0  
**ะะฐัะฐ**: 2025-10-24  
**ะกะพะฒะผะตััะธะผะพััั**: CoinFlow Bot v3.1+
