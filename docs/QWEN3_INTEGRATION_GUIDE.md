# ะัะบะพะฒะพะดััะฒะพ ะฟะพ ะธะฝัะตะณัะฐัะธะธ Qwen3 Cloud Models ะฒ CoinFlow Bot

## ะะฑะทะพั ะธะทะผะตะฝะตะฝะธะน

CoinFlow Bot v3.1+ ัะตะฟะตัั ะธัะฟะพะปัะทัะตั ะพะฑะปะฐัะฝัะต ะผะพะดะตะปะธ **Qwen3** ัะตัะตะท Ollama ะดะปั ัะฐััะธัะตะฝะฝะพะณะพ ะะ-ััะฝะบัะธะพะฝะฐะปะฐ:

- **qwen3-coder:480b-cloud** - ะดะปั ัะตะบััะพะฒัั ะทะฐะฟัะพัะพะฒ, ัะฟัะฐะฒะปะตะฝะธั ะฑะพัะพะผ ะธ ะณะตะฝะตัะฐัะธะธ ะฟัะพะณะฝะพะทะพะฒ
- **qwen3-vl:235b-cloud** - ะดะปั ะฒะธะทัะฐะปัะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ ะณัะฐัะธะบะพะฒ ัะตะฝ

### ะะปััะตะฒัะต ัะปัััะตะฝะธั

1. **ะะธะทัะฐะปัะฝัะน ะฐะฝะฐะปะธะท ะฟัะพะณะฝะพะทะพะฒ**: ะัะฐัะธะบ ัะตะฝ ะฐะฝะฐะปะธะทะธััะตััั ะะ-ะผะพะดะตะปัั ั ะบะพะผะฟัััะตัะฝัะผ ะทัะตะฝะธะตะผ
2. **ะะพะดะดะตัะถะบะฐ ะฐะบัะธะน**: ะะ-ะฐััะธััะตะฝั ัะตะฟะตัั ะฟะพะฝะธะผะฐะตั ะทะฐะฟัะพัั ะพะฑ ะฐะบัะธัั (AAPL, TSLA, SBER.ME ะธ ั.ะด.)
3. **ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝะฐั ััััะบัััะฐ**: ะฆะ ะะค ะธะฝัะตะณัะธัะพะฒะฐะฝ ะบะฐะบ ะฐะปััะตัะฝะฐัะธะฒะฝัะน ะธััะพัะฝะธะบ ะดะฐะฝะฝัั ะดะปั ัะธะฐัะฐ
4. **ะะฐััะธัะตะฝะฝัะน ะบะพะฝัะตะบัั**: 32K ัะพะบะตะฝะพะฒ ะดะปั ะฑะพะปะตะต ัะปะพะถะฝัั ะดะธะฐะปะพะณะพะฒ

---

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ

### ะจะฐะณ 1: ะฃััะฐะฝะพะฒะบะฐ Ollama

```bash
# ะกะบะฐัะฐะนัะต ะธ ัััะฐะฝะพะฒะธัะต Ollama ั ะพัะธัะธะฐะปัะฝะพะณะพ ัะฐะนัะฐ
# https://ollama.ai

# ะัะพะฒะตัััะต ัััะฐะฝะพะฒะบั
ollama --version
```

### ะจะฐะณ 2: ะะฐะณััะทะบะฐ ะผะพะดะตะปะตะน

โ๏ธ **ะะะะะะะะ**: ะญัะธ ะผะพะดะตะปะธ ะพัะตะฝั ะฑะพะปััะธะต (~480GB ะธ ~235GB) ะธ ััะตะฑััั ะผะพัะฝะพะณะพ ะถะตะปะตะทะฐ!

```bash
# ะะฐะณััะทะธัั ัะตะบััะพะฒัั ะผะพะดะตะปั (ะผะพะถะตั ะทะฐะฝััั ะฝะตัะบะพะปัะบะพ ัะฐัะพะฒ)
ollama pull qwen3-coder:480b-cloud

# ะะฐะณััะทะธัั ะฒะธะทัะฐะปัะฝัั ะผะพะดะตะปั
ollama pull qwen3-vl:235b-cloud
```

**ะะปััะตัะฝะฐัะธะฒะฐ ะดะปั ัะตััะธัะพะฒะฐะฝะธั** (ะผะตะฝััะธะต ะผะพะดะตะปะธ):
```bash
# ะัะฟะพะปัะทัะนัะต ะผะตะฝััะธะต ะผะพะดะตะปะธ ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
ollama pull qwen3:8b
ollama pull llava:7b
```

### ะจะฐะณ 3: ะะพะฝัะธะณััะฐัะธั ะฑะพัะฐ

ะะฑะฝะพะฒะธัะต `.env` ัะฐะนะป:

```env
# Ollama AI settings
OLLAMA_URL=http://localhost:11434
OLLAMA_TEXT_MODEL=qwen3-coder:480b-cloud
OLLAMA_VISION_MODEL=qwen3-vl:235b-cloud

# ะะปั ะปะพะบะฐะปัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั ะธัะฟะพะปัะทัะนัะต ะผะตะฝััะธะต ะผะพะดะตะปะธ:
# OLLAMA_TEXT_MODEL=qwen3:8b
# OLLAMA_VISION_MODEL=llava:7b
```

### ะจะฐะณ 4: ะะฐะฟััะบ ะฑะพัะฐ

```bash
# ะฃะฑะตะดะธัะตัั, ััะพ Ollama ะทะฐะฟััะตะฝ
# Ollama ัะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพัะปะต ัััะฐะฝะพะฒะบะธ

# ะะฐะฟัััะธัะต ะฑะพัะฐ
python main.py
```

---

## ะััะธัะตะบัััะฐ

### ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 CoinFlow Bot                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                      โ
โ  โโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ  AI Service   โโโโโโโโค  Prediction Gen.   โ    โ
โ  โ (2 models)    โ      โ  (with vision)     โ    โ
โ  โโโโโโโโโฌโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโ    โ
โ          โ                                          โ
โ  โโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ       โ
โ  โ        Ollama API Server                โ       โ
โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ   โ       โ
โ  โ  โ qwen3-coder  โ  โ  qwen3-vl    โ   โ       โ
โ  โ  โ 480b-cloud   โ  โ  235b-cloud  โ   โ       โ
โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ   โ       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ       โ
โ                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพะฒัะต ะผะตัะพะดั ะฒ AI Service

#### `get_text_response(prompt, system_prompt, temperature, max_tokens)`
ะะพะปััะตะฝะธะต ัะตะบััะพะฒะพะณะพ ะพัะฒะตัะฐ ะพั qwen3-coder.

```python
response = await ai_service.get_text_response(
    prompt="ะงัะพ ัะฐะบะพะต Bitcoin?",
    system_prompt="ะขั ัะธะฝะฐะฝัะพะฒัะน ะฐััะธััะตะฝั",
    temperature=0.7,
    max_tokens=1000
)
```

#### `get_vision_analysis(image_path, prompt, temperature)`
ะะฝะฐะปะธะท ะธะทะพะฑัะฐะถะตะฝะธั ั ะฟะพะผะพััั qwen3-vl.

```python
analysis = await ai_service.get_vision_analysis(
    image_path="/tmp/chart.png",
    prompt="ะัะพะฐะฝะฐะปะธะทะธััะน ััะพั ะณัะฐัะธะบ ัะตะฝ BTC",
    temperature=0.7
)
```

### ะฃะปัััะตะฝะฝัะน ะฟัะพะณะฝะพะท ั ะฒะธะทัะฐะปัะฝัะผ ะฐะฝะฐะปะธะทะพะผ

```python
# ะ prediction_generator ัะตะฟะตัั ะดะพัััะฟะตะฝ ะผะตัะพะด:
chart_bytes, stats, vision_analysis = await prediction_generator.generate_prediction_with_vision_analysis(
    symbol='BTC-USD',
    asset_type='crypto',
    model_type='arima',
    days=90,
    forecast_days=7
)

# ะะตะทัะปััะฐั ะฒะบะปััะฐะตั:
# - chart_bytes: ะธะทะพะฑัะฐะถะตะฝะธะต ะณัะฐัะธะบะฐ
# - stats: ัะธัะปะพะฒัะต ััะฐัะธััะธะบะธ (ARIMA/LinReg)
# - vision_analysis: ัะตะบััะพะฒัะน ะฐะฝะฐะปะธะท ะพั qwen3-vl
```

---

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### 1. ะัะพะณะฝะพะทั ั ะฒะธะทัะฐะปัะฝัะผ ะฐะฝะฐะปะธะทะพะผ

```python
# ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ handler
async def handle_forecast(update, context):
    symbol = 'AAPL'  # ะะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะบัะธะฟัะพะฒะฐะปััั ะธะปะธ ะฐะบัะธะธ
    
    # ะะตะฝะตัะธััะตะผ ะฟัะพะณะฝะพะท ั AI-ะฐะฝะฐะปะธะทะพะผ
    chart, stats, ai_analysis = await bot.prediction_generator.generate_prediction_with_vision_analysis(
        symbol=symbol,
        asset_type='stock',
        model_type='arima'
    )
    
    # ะคะพัะผะธััะตะผ ัะพะพะฑัะตะฝะธะต
    message = f"""
๐ **ะัะพะณะฝะพะท ะดะปั {symbol}**

๐ ะขะตะบััะฐั ัะตะฝะฐ: ${stats['current']:.2f}
๐ฎ ะัะพะณะฝะพะท (7 ะดะฝะตะน): ${stats['predicted']:.2f}
๐ ะะทะผะตะฝะตะฝะธะต: {stats['change']:+.2f}%
๐ฏ ะะพะดะตะปั: {stats['model']}

๐ค **AI-ะฐะฝะฐะปะธะท ะณัะฐัะธะบะฐ:**
{ai_analysis}

โ๏ธ ะญัะพ ะฝะต ัะธะฝะฐะฝัะพะฒะฐั ัะตะบะพะผะตะฝะดะฐัะธั.
"""
    
    await update.message.reply_photo(photo=chart, caption=message)
```

### 2. ะะ-ะฐััะธััะตะฝั ั ะฟะพะดะดะตัะถะบะพะน ะฐะบัะธะน

ะขะตะฟะตัั ะฑะพั ะฟะพะฝะธะผะฐะตั ะทะฐะฟัะพัั ัะธะฟะฐ:
- "ะะพะบะฐะถะธ ะณัะฐัะธะบ Apple"
- "ะัะพะณะฝะพะท ะดะปั ะกะฑะตัะฑะฐะฝะบะฐ"
- "ะกะบะพะปัะบะพ ััะพะธั Tesla?"
- "ะกัะฐะฒะฝะธ BTC ะธ AAPL"

```python
# ะัะธะผะตั ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะฐ
result = await ai_service.interpret_user_message(
    message="ะะพะบะฐะถะธ ะณัะฐัะธะบ Tesla",
    user_lang='ru'
)

if result['type'] == 'command':
    action = result['action']  # 'CHART'
    symbol = result['params']['symbol']  # 'TSLA'
    # ะัะฟะพะปะฝะธัั ะบะพะผะฐะฝะดั...
```

### 3. ะะฝัะตะณัะฐัะธั ะฐะบัะธะน

ะะบัะธะธ ัะตะฟะตัั ัะฒะปััััั ะฟะตัะฒะพะบะปะฐััะฝัะผะธ ะฐะบัะธะฒะฐะผะธ ะฒ ะฑะพัะต:

```python
# ะ StockService ัะถะต ะธะฝัะตะณัะธัะพะฒะฐะฝั:
GLOBAL_STOCKS = {
    'AAPL': 'Apple Inc.',
    'MSFT': 'Microsoft',
    'TSLA': 'Tesla',
    # ... ะธ 20+ ะดััะณะธั
}

RUSSIAN_STOCKS = {
    'SBER': 'ะกะฑะตัะฑะฐะฝะบ',
    'GAZP': 'ะะฐะทะฟัะพะผ',
    'LKOH': 'ะัะบะพะนะป',
    # ... ะธ 15+ ะดััะณะธั
}
```

---

## ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะธ ััะพะธะผะพััั

### ะขัะตะฑะพะฒะฐะฝะธั ะบ ะถะตะปะตะทั

**ะะปั ะพะฑะปะฐัะฝัั ะผะพะดะตะปะตะน (480B/235B):**
- GPU: 8x NVIDIA A100 (80GB) ะธะปะธ ะฐะฝะฐะปะพะณ
- RAM: 512GB+
- ะะธัะบ: 1TB+ SSD

**ะะปั ะปะพะบะฐะปัะฝัั ะผะพะดะตะปะตะน (8B/7B):**
- GPU: NVIDIA RTX 3090 (24GB) ะธะปะธ ะฐะฝะฐะปะพะณ
- RAM: 32GB
- ะะธัะบ: 50GB SSD

### ะัะตะผั ะพะฑัะฐะฑะพัะบะธ

| ะะฟะตัะฐัะธั | Cloud Model | Local Model |
|----------|-------------|-------------|
| ะขะตะบััะพะฒัะน ะพัะฒะตั | 2-5 ัะตะบ | <1 ัะตะบ |
| ะะธะทัะฐะปัะฝัะน ะฐะฝะฐะปะธะท | 5-15 ัะตะบ | 2-5 ัะตะบ |
| ะัะพะณะฝะพะท ั vision | 15-30 ัะตะบ | 5-10 ัะตะบ |

### ะกัะพะธะผะพััั (ะฟัะธะผะตัะฝะฐั)

**Cloud hosting:**
- ~$3-5 ะทะฐ GPU-ัะฐั (AWS/GCP)
- ~$100-200/ะดะตะฝั ะฟัะธ ะฐะบัะธะฒะฝะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ

**ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ:**
- ะกัะพะธะผะพััั ัะปะตะบััะธัะตััะฒะฐ (~300W GPU)
- ะะผะพััะธะทะฐัะธั ะถะตะปะตะทะฐ

โ๏ธ **ะะตะบะพะผะตะฝะดะฐัะธั**: ะัะฟะพะปัะทัะนัะต ะผะตะฝััะธะต ะผะพะดะตะปะธ ะดะปั ัะฐะทัะฐะฑะพัะบะธ ะธ ัะตััะธัะพะฒะฐะฝะธั!

---

## Troubleshooting

### ะัะพะฑะปะตะผะฐ: ะะพะดะตะปะธ ะฝะต ะทะฐะณััะถะฐัััั

```bash
# ะัะพะฒะตัััะต ััะฐััั Ollama
ollama list

# ะะพะฟัะพะฑัะนัะต ะทะฐะณััะทะธัั ะผะพะดะตะปั ะฒัััะฝัั
ollama pull qwen3-coder:480b-cloud

# ะัะพะฒะตัััะต ะปะพะณะธ
journalctl -u ollama -f
```

### ะัะพะฑะปะตะผะฐ: Vision ะฐะฝะฐะปะธะท ะฝะต ัะฐะฑะพัะฐะตั

ะัะพะฒะตัััะต, ััะพ ะผะพะดะตะปั ะดะพัััะฟะฝะฐ:
```python
if bot.ai_service.vision_available:
    print("Vision model OK")
else:
    print("Vision model not available")
```

### ะัะพะฑะปะตะผะฐ: ะะตะดะปะตะฝะฝะฐั ะณะตะฝะตัะฐัะธั

1. ะัะพะฒะตัััะต GPU ััะธะปะธะทะฐัะธั: `nvidia-smi`
2. ะัะฟะพะปัะทัะนัะต ะผะตะฝััะธะต ะผะพะดะตะปะธ ะดะปั ัะตััะธัะพะฒะฐะฝะธั
3. ะะฐัััะพะนัะต `max_tokens` ะธ `temperature`

### ะัะพะฑะปะตะผะฐ: Out of Memory

ะฃะผะตะฝััะธัะต ัะฐะทะผะตั ะผะพะดะตะปะธ:
```env
OLLAMA_TEXT_MODEL=qwen3:8b
OLLAMA_VISION_MODEL=llava:7b
```

---

## Migration Guide

### ะะฑะฝะพะฒะปะตะฝะธะต ั v3.0

1. ะะฑะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ:
```bash
poetry install
```

2. ะะฑะฝะพะฒะธัะต `.env`:
```bash
cp .env .env.backup
cat .env.example >> .env
# ะััะตะดะฐะบัะธััะนัะต ะฝะพะฒัะต ะฟะตัะตะผะตะฝะฝัะต
```

3. ะะฐะณััะทะธัะต ะผะพะดะตะปะธ (ัะผ. ะจะฐะณ 2)

4. ะะตัะตะทะฐะฟัััะธัะต ะฑะพัะฐ

### ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

ะะพั ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐะตั ะฑะตะท AI-ะผะพะดะตะปะตะน:
- ะกัะฐะฝะดะฐััะฝัะต ะฟัะพะณะฝะพะทั (ARIMA/LinReg) ัะฐะฑะพัะฐัั
- ะะพะฝะฒะตััะฐัะธั ะฒะฐะปัั ัะฐะฑะพัะฐะตั
- ะัะฐัะธะบะธ ะณะตะฝะตัะธัััััั

ะขะพะปัะบะพ ะฒะธะทัะฐะปัะฝัะน ะฐะฝะฐะปะธะท ััะตะฑัะตั qwen3-vl.

---

## API Reference

### AIService

```python
class AIService:
    def __init__(self, ollama_url: str, 
                 text_model: str, 
                 vision_model: str)
    
    async def check_availability(self, auto_pull: bool = False) -> bool
    async def get_text_response(self, prompt: str, ...) -> str
    async def get_vision_analysis(self, image_path: str, ...) -> str
    async def interpret_user_message(self, message: str, ...) -> Dict
```

### PredictionGenerator

```python
class PredictionGenerator:
    def __init__(self, dpi: int, db, ai_service)
    
    async def generate_prediction_with_vision_analysis(
        self, 
        symbol: str,
        asset_type: str = 'crypto',
        model_type: str = 'arima',
        days: int = 90,
        forecast_days: int = 7
    ) -> Tuple[bytes, Dict, str]
```

---

## ะะฐะปัะฝะตะนัะตะต ัะฐะทะฒะธัะธะต

### ะะปะฐะฝะธััะตะผัะต ัะปัััะตะฝะธั

- [ ] ะััะธัะพะฒะฐะฝะธะต AI-ะพัะฒะตัะพะฒ ะดะปั ะฟะพะฟัะปััะฝัั ะทะฐะฟัะพัะพะฒ
- [ ] Batch-ะพะฑัะฐะฑะพัะบะฐ ะผะฝะพะถะตััะฒะตะฝะฝัั ะฟัะพะณะฝะพะทะพะฒ
- [ ] Fine-tuning ะผะพะดะตะปะตะน ะฝะฐ ัะธะฝะฐะฝัะพะฒัั ะดะฐะฝะฝัั
- [ ] ะะฝัะตะณัะฐัะธั ั ัะตะฐะปัะฝัะผะธ ัะพัะณะพะฒัะผะธ ัะธะณะฝะฐะปะฐะผะธ
- [ ] ะัะปััะธัะทััะฝัะน ะฐะฝะฐะปะธะท ะฝะพะฒะพััะตะน

### ะญะบัะฟะตัะธะผะตะฝัะฐะปัะฝัะต ััะฝะบัะธะธ

- Sentiment analysis ะธะท ะฝะพะฒะพััะตะน
- Portfolio optimization ั ะฟะพะผะพััั AI
- ะะฒัะพะผะฐัะธัะตัะบะธะต ัะพัะณะพะฒัะต ัััะฐัะตะณะธะธ
- Real-time market commentary

---

## ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:

1. ะัะพะฒะตัััะต ะปะพะณะธ: `tail -f coinflow.log`
2. ะัะพะฒะตัััะต ััะฐััั Ollama: `ollama list`
3. ะัะบัะพะนัะต issue ะฝะฐ GitHub
4. ะะพะฝััะปััะธััะนัะตัั ั ะดะพะบัะผะตะฝัะฐัะธะตะน Ollama: https://ollama.ai/docs

---

## ะะธัะตะฝะทะธั

CoinFlow Bot - MIT License
Qwen3 Models - ัะผ. ะปะธัะตะฝะทะธั ะฝะฐ https://qwenlm.github.io/

---

**ะะตััะธั ะดะพะบัะผะตะฝัะฐ**: 1.0  
**ะะฐัะฐ**: 2025-10-24  
**ะกะพะฒะผะตััะธะผะพััั**: CoinFlow Bot v3.1+
